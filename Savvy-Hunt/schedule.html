<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Schedule - Savvy Hunt</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* ========================================= */
        /* LOADER STYLES                */
        /* ========================================= */
        #global-loader {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background-color: #FFF7ED;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.6s;
        }

        .loader-bot {
            width: 80px;
            height: 80px;
            margin-bottom: 2rem;
            position: relative;
            z-index: 10;
            animation: floatLoader 3s ease-in-out infinite;
        }

        .l-bot-body {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, #ffffff, #fff7ed);
            border-radius: 50%;
            box-shadow: 
                inset -4px -4px 12px rgba(234, 88, 12, 0.15), 
                0 15px 35px -5px rgba(234, 88, 12, 0.15), 
                0 0 0 2px rgba(255,255,255,0.9);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .l-bot-eye {
            width: 45px;
            height: 26px;
            background: #0f172a;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            border: 3px solid #ffb46b;
            box-shadow: inset 0 0 6px #000;
        }

        .l-bot-pupil {
            width: 14px;
            height: 14px;
            background: #f97316;
            border-radius: 50%;
            position: absolute;
            top: 3px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 10px #f97316;
            animation: scanEye 1.5s ease-in-out infinite alternate;
        }

        .l-bot-antenna {
            position: absolute;
            top: -14px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 16px;
            background: #cbd5e1;
            z-index: -1;
        }
        .l-bot-antenna::after {
            content: '';
            position: absolute;
            top: -6px;
            left: -4px;
            width: 12px;
            height: 12px;
            background: #f97316;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.6);
            animation: blinkAntenna 2s infinite;
        }

        .pulse-ring {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            border: 1px solid rgba(249, 115, 22, 0.3);
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.1);
            opacity: 0;
            z-index: -1;
        }
        .ring-1 { width: 100%; height: 100%; animation: ripple 2s linear infinite; }
        .ring-2 { width: 100%; height: 100%; animation: ripple 2s linear infinite 0.6s; }

        .loader-title {
            font-size: 1.5rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            color: #1e293b;
            margin-bottom: 0.5rem;
            opacity: 0;
            animation: fadeUp 0.8s ease-out forwards 0.2s;
        }

        .loader-subtitle {
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: #f97316;
            margin-bottom: 2rem;
            opacity: 0;
            animation: fadeUp 0.8s ease-out forwards 0.4s;
        }

        .progress-container {
            width: 200px;
            height: 4px;
            background: #ffedd5;
            border-radius: 99px;
            overflow: hidden;
            position: relative;
            opacity: 0;
            animation: fadeIn 0.8s ease-out forwards 0.6s;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #f97316, #ea580c);
            width: 0%;
            border-radius: 99px;
            animation: loadProgress 2.5s ease-in-out forwards;
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.5);
        }

        @keyframes floatLoader {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes scanEye {
            0% { transform: translateX(-12px); }
            100% { transform: translateX(12px); }
        }
        @keyframes blinkAntenna {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        @keyframes ripple {
            0% { width: 80px; height: 80px; opacity: 0.8; border-width: 2px; }
            100% { width: 200px; height: 200px; opacity: 0; border-width: 0px; }
        }
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        @keyframes loadProgress {
            0% { width: 0%; }
            40% { width: 70%; }
            100% { width: 100%; }
        }

        .content-loaded #global-loader {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* ========================================= */
        /* MAIN PAGE STYLES             */
        /* ========================================= */
        body {
            font-family: "Plus Jakarta Sans", system-ui;
            background: linear-gradient(145deg, #FFF7ED 0%, #FFEEDD 40%, #FFF4E5 70%);
            background-attachment: fixed;
            margin: 0;
            overflow: hidden; /* Lock scroll initially for loader */
        }

        .bg-parallax-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 22vh;
            font-weight: 900;
            color: rgba(234, 88, 12, 0.06);
            white-space: nowrap;
            pointer-events: none;
            user-select: none;
            z-index: 0;
        }

        header.schedule-hero {
            position: relative;
            width: 100%;
            overflow: hidden;
            padding-top: 2.5rem;
            padding-bottom: 7rem;
            background: linear-gradient(120deg,#ff7a1a,#ff5e00,#ea580c,#b63a00);
            background-size: 200% 200%;
            animation: heroGradient 8s ease infinite;
            border-bottom-left-radius: 3rem;
            border-bottom-right-radius: 3rem;
            box-shadow: 0 25px 50px -15px rgba(227,72,0,0.7);
            z-index: 5;
        }

        @keyframes heroGradient {
            0%{background-position:0% 50%;}
            50%{background-position:100% 50%;}
            100%{background-position:0% 50%;}
        }

        header.schedule-hero::before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(circle at 20% -10%, rgba(255, 255, 255, 0.4) 0, transparent 55%),
                radial-gradient(circle at 80% 0%, rgba(254, 243, 199, 0.45) 0, transparent 60%);
            pointer-events: none;
            z-index: 1;
        }

        .schedule-hero-inner {
            position: relative;
            z-index: 10;
            max-width: 64rem;
            margin: 0 auto;
            padding: 0 1.5rem;
            text-align: center;
        }

        .back-pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 700;
            color: #fffbeb;
            margin-bottom: 16px;
            border: 1px solid rgba(255,255,255,0.6);
            transition: all 0.2s ease;
            text-decoration: none;
        }
        .back-pill:hover {
            background: #fefce8;
            color: #c2410c;
            transform: translateY(-1px);
            box-shadow: 0 12px 25px -12px rgba(0, 0, 0, 0.6);
        }

        .schedule-title {
            text-shadow: 0 2px 12px rgba(0,0,0,0.45);
            letter-spacing: -0.05em;
            font-size: clamp(2.4rem, 4vw, 3.2rem);
            line-height: 1.1;
        }
        .schedule-sub {
            font-size: 0.9rem;
            color: #fffbeb;
            opacity: 0.97;
            margin-top: 0.4rem;
            font-weight: 500;
        }

        .search-container {
            max-width: 480px;
            margin: 2.2rem auto 0;
            position: relative;
            z-index: 20;
        }
        
        .search-input {
            width: 100%;
            padding: 16px 60px 16px 22px;
            border-radius: 999px;
            border: 2px solid #fb923c;
            background: #ffffff;
            color: #983007;
            font-size: 0.95rem;
            font-weight: 600;
            outline: none;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow:
                0 12px 26px -8px rgba(227,72,0,0.3),
                0 0 0 1px rgba(255,255,255,0.9);
        }
        
        .search-input::placeholder {
            color: #ea580c;
            font-weight: 500;
        }

        .search-input:focus {
            transform: translateY(-1px);
            box-shadow:
                0 20px 40px -20px rgba(124, 45, 18, 0.95),
                0 0 0 1px #fffbeb,
                0 0 0 2px #fb923c;
        }
        
        .search-icon-btn {
            position: absolute;
            right: 7px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg,#ff7a1a,#ea580c);
            color: white;
            border-radius: 999px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 14px rgba(227,72,0,0.65);
            pointer-events: none;
        }

        /* ===== TOGGLE SWITCH ===== */
        .toggle-wrapper {
            margin-top: 2rem;
            display: flex;
            justify-content: center;
            position: relative;
            z-index: 20;
        }
        
        .toggle-container {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(8px);
            padding: 6px;
            border-radius: 999px;
            display: inline-flex;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .toggle-btn {
            padding: 10px 24px;
            border-radius: 999px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: none;
            outline: none;
            position: relative;
            z-index: 2;
            white-space: nowrap;
        }

        .toggle-btn.active {
            background-color: #ffffff;
            color: #ea580c;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .toggle-btn.inactive {
            background-color: transparent;
            color: rgba(255, 255, 255, 0.95);
        }
        .toggle-btn.inactive:hover {
            color: #ffffff;
            background-color: rgba(255, 255, 255, 0.15);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 20px 40px;
            position: relative;
            z-index: 2;
        }

        /* ===== FLIP CARDS ===== */
        .flip-card {
            background-color: transparent;
            width: 100%;
            height: 360px; 
            perspective: 1000px;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            transform-style: preserve-3d;
            border-radius: 24px; 
            box-shadow: 0 18px 45px -16px rgba(227,72,0,0.35);
        }

        .flip-card:hover .flip-card-inner:not(.flipped) {
            transform: translateY(-5px);
        }

        .flipped {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 24px;
            padding: 26px 22px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            color: #111827;
            border: 1px solid rgba(255, 255, 255, 0.95);
            background: linear-gradient(145deg, #ffffff, #fff7ed);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
        }

        .flip-card-front {
            z-index: 2;
            transform: rotateY(0deg);
            box-shadow:
                0 0 0 1px rgba(254, 243, 199, 0.95),
                0 18px 36px -24px rgba(148, 64, 12, 0.4),
                inset 0 0 26px rgba(255,255,255,0.9);
        }

        .flip-card-front.is-results {
            border: 2px solid #ffb300;
            background: linear-gradient(145deg, #ffffff, #ffe782);
            box-shadow:
                0 0 0 1px rgba(250, 204, 21, 0.95),
                0 20px 44px -20px rgba(251, 191, 36, 0.8),
                inset 0 0 24px rgba(253, 230, 138, 0.7);
        }

        .flip-card-back {
            transform: rotateY(180deg);
            z-index: 1;
            box-shadow:
                0 0 0 1px rgba(254, 243, 199, 0.9),
                0 18px 36px -24px rgba(124, 45, 18, 0.35),
                inset 0 0 24px rgba(255, 251, 235, 0.95);
        }

        /* ===== CUSTOM SCROLLBAR FOR RESULTS ===== */
        .results-scroll-area {
            overflow-y: auto;
            padding-right: 4px; /* Space for scrollbar */
            /* Firefox */
            scrollbar-width: thin;
            scrollbar-color: #fb923c rgba(255, 237, 213, 0.3);
        }
        
        /* Webkit (Chrome, Safari, Edge) */
        .results-scroll-area::-webkit-scrollbar {
            width: 5px;
        }
        .results-scroll-area::-webkit-scrollbar-track {
            background: transparent;
        }
        .results-scroll-area::-webkit-scrollbar-thumb {
            background-color: #fb923c;
            border-radius: 20px;
            border: 1px solid transparent;
            background-clip: content-box;
        }

        .badge-container {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px; 
            flex-shrink: 0;
        }

        /* Prevent selection */
        *, *::before, *::after {
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
        }
        input, textarea {
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
            user-select: text !important;
        }

        .status-badge, .category-pill { 
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            padding: 6px 14px;
            border-radius: 999px;
            box-shadow: 0 2px 5px rgba(148, 64, 12, 0.18);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .status-live {
            background: #ffdbdb;
            color: #b91c1c;
            border: 2px solid #ef4444;
            position: relative;
        }
        .status-live::before {
            content: "";
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: #ef4444;
            box-shadow: 0 0 10px rgba(239,68,68,0.9);
        }

        .status-soon {
            background: #fef3c7;
            color: #d97706;
            border: 1px solid #fde68a;
        }

        .status-done {
            background: #f3f4f6;
            color: #4b5563;
            border: 1px solid #e5e7eb;
        }

        .category-pill {
            background: white;
            border: 2px solid #fb923c;
            color: #9a3412;
        }

        .main-content {
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .main-content h3 {
            font-size: 1.5rem;
            font-weight: 800;
            color: #7c2d12;
            line-height: 1.1;
            margin-bottom: 10px;
            letter-spacing: -0.04em;
        }
        .main-content .location {
            font-size: 0.95rem;
            color: #4b5563;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            font-weight: 500;
        }
        .main-content .teams-registered {
            font-size: 0.8rem;
            color: #9ca3af;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.12em;
        }

        .action-btn {
            width: 100%;
            padding: 12px 14px; 
            border-radius: 16px; 
            font-weight: 800;
            font-size: 0.9rem;
            cursor: pointer;
            border: none;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: auto;
            position: relative; 
            overflow: hidden;
            flex-shrink: 0;
            letter-spacing: 0.06em;
            text-transform: uppercase;
        }

        .action-btn::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: linear-gradient(120deg, rgba(255,255,255,0.22), transparent 40%);
            transform: translateX(-120%);
            transition: transform 0.4s ease;
            pointer-events: none;
        }

        .btn-view { 
            background: linear-gradient(135deg,#ff7a1a,#ff5e00);
            color: white; 
            box-shadow: 0 10px 24px rgba(227,72,0,0.65);
        }
        .btn-view:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 14px 28px rgba(227,72,0,0.75);
        }
        .btn-view:hover::after {
            transform: translateX(0%);
        }
        
        .btn-back { 
            background: #ffffff;
            color: #9a3412; 
            border: 1px solid #fed7aa;
            margin-top: 15px;
            box-shadow: 0 6px 12px -6px rgba(124, 45, 18, 0.4);
        }
        .btn-back:hover { 
            background: #fff7ed;
            color: #7c2d12;
            transform: translateY(-2px);
        }
        .btn-back:hover::after {
            transform: translateX(0%);
        }

        /* COMPACT ROW STYLES FOR BACK OF CARD */
        .winner-row { 
            display: flex; 
            align-items: center; 
            margin-bottom: 4px; /* Compact */
            background: white;
            padding: 6px 10px; /* Compact */
            border-radius: 12px;
            border: 1px solid #f3f4f6;
            width: 100%;
            transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
            flex-shrink: 0;
            min-height: 0;
        }
        .winner-row:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 14px rgba(148, 64, 12, 0.2);
            border-color: #fed7aa;
        }
        .winner-row:last-child { margin-bottom: 0; }
        
        .medal { 
            font-size: 1.2em; /* Slightly smaller */
            margin-right: 8px; 
            flex-shrink: 0; 
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.18)); 
        }
        .winner-info { 
            display: flex; 
            flex-direction: column; 
            text-align: left; 
            overflow: hidden; 
        }
        .student-name { 
            font-weight: 700; 
            color: #111827; 
            font-size: 0.85rem; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
        }
        .school-name { 
            font-size: 0.6rem; 
            color: #6b7280; 
            font-weight: 600; 
            text-transform: uppercase; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
        }

        #status-message {
            text-align: center;
            padding: 40px 16px;
        }

        #no-results {
            text-align: center;
            padding: 40px 16px;
        }

        .return-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: linear-gradient(135deg, #0f172a, #020617);
            color: #f9fafb;
            padding: 12px 26px;
            border-radius: 999px;
            font-weight: 800;
            font-size: 0.9rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            text-decoration: none;
            box-shadow: 0 14px 30px -12px rgba(15,23,42,0.95);
            transition: all 0.25s ease;
        }
        .return-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 18px 38px -14px rgba(15,23,42,0.95);
        }
        .return-btn span.icon {
            font-size: 1.1rem;
        }

        @media (max-width: 640px) {
            header.schedule-hero {
                border-bottom-left-radius: 2rem;
                border-bottom-right-radius: 2rem;
                padding-bottom: 5rem;
            }
            .flip-card {
                height: 340px;
            }
            .toggle-wrapper {
                margin-top: 1.5rem;
            }
            .toggle-btn {
                padding: 8px 16px;
                font-size: 0.8rem;
            }
        }

        /* ===== SAVVY BOT STYLES ===== */
        #savvy-bot-container {
            position: fixed;
            z-index: 110;
            top: 0;
            left: 0;
            width: 60px;
            height: 60px;
            transition: transform 4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: auto;
            cursor: pointer;
        }
        .bot-body {
            width: 48px;
            height: 48px;
            margin: 6px;
            background: radial-gradient(circle at 30% 30%, #ffffff, #fff7ed);
            border-radius: 50%;
            box-shadow:
                inset -3px -3px 8px rgba(234, 88, 12, 0.18),
                0 8px 20px rgba(0,0,0,0.18),
                0 0 0 2px rgba(255,255,255,0.9);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: floatOrganic 6s ease-in-out infinite;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .bot-body:active { transform: scale(0.9); }
        .bot-body.windblown { transform: rotate(-10deg) translateX(-4px); }

        .bot-cheek {
            position: absolute;
            top: 28px;
            width: 6px;
            height: 4px;
            background: #fdba74;
            border-radius: 50%;
            opacity: 0.8;
            filter: blur(1px);
            z-index: 2;
        }
        .cheek-left { left: 8px; }
        .cheek-right { right: 8px; }

        .bot-eye {
            width: 32px;
            height: 18px;
            background: #0f172a;
            border-radius: 14px;
            position: relative;
            overflow: hidden;
            border: 2px solid #ffb46b;
            box-shadow: inset 0 0 4px #000;
            z-index: 3;
            transition: all 0.2s ease;
        }
        .bot-pupil {
            width: 10px;
            height: 10px;
            background: #ff7300; 
            border-radius: 50%;
            position: absolute;
            top: 4px;
            left: 11px;
            box-shadow: none;
            transition: transform 0.1s, box-shadow 0.15s ease, background 0.15s ease;
        }

        .bot-body.scanning .bot-pupil {
            background: #ff5e00;
            box-shadow: 0 0 8px #ff5e00;
        }

        .bot-eye.sleeping {
            height: 3px;
            margin-top: 6px;
            background: #334155;
            border-color: #475569;
        }
        .bot-eye.sleeping .bot-pupil { opacity: 0; }

        .laser-cone {
            position: absolute;
            top: 21px;
            left: 50%;
            transform: translateX(-50%) perspective(300px) rotateX(18deg);
            width: 42px;
            height: 0;
            background: linear-gradient(to bottom, rgba(255,98,0,0.85) 0%,rgba(255,98,0,0.05) 100%);
            clip-path: polygon(40% 0, 60% 0, 100% 100%, 0% 100%);
            opacity: 0;
            z-index: 50;
            pointer-events: none;
            transition: height 0.3s ease-out, opacity 0.3s ease-out;
            filter: drop-shadow(0 0 6px rgba(255,98,0,1));
            mix-blend-mode: hard-light;
        }

        .bot-antenna {
            position: absolute;
            top: -10px;
            left: 22px;
            width: 3px;
            height: 10px;
            background: #94a3b8;
            z-index: -1;
        }
        .bot-antenna::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -2.5px;
            width: 8px;
            height: 8px;
            background: #f97316;
            border-radius: 50%;
            box-shadow: 0 0 8px #f97316;
        }

        .bot-bubble {
            position: absolute;
            top: -45px;
            left: 50%;
            transform: translateX(-50%) scale(0) translateY(10px);
            background: rgba(255, 255, 255, 0.97);
            backdrop-filter: blur(8px);
            padding: 8px 14px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            font-size: 11px;
            font-weight: 700;
            color: #c2410c;
            white-space: nowrap;
            opacity: 0;
            transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            border: 1px solid white;
        }
        .bot-bubble.show {
            opacity: 1;
            transform: translateX(-50%) scale(1) translateY(0);
        }
        .bot-bubble::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            margin-left: -5px;
            border-width: 5px 5px 0;
            border-style: solid;
            border-color: #fff transparent transparent transparent;
        }

        @keyframes floatOrganic {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(0, -8px) rotate(2deg); }
            66% { transform: translate(0, -4px) rotate(-2deg); }
        }
        @keyframes scanPulse {
            0% { opacity: 0.7; transform: scaleX(1); }
            100% { opacity: 1; transform: scaleX(1.2); }
        }
    </style>
</head>
<body>

    <div id="global-loader">
        <div class="loader-bot">
            <div class="pulse-ring ring-1"></div>
            <div class="pulse-ring ring-2"></div>
            <div class="l-bot-antenna"></div>
            <div class="l-bot-body">
                <div class="l-bot-eye">
                    <div class="l-bot-pupil"></div>
                </div>
            </div>
        </div>
        <h1 class="loader-title">
            Savvy<span class="text-orange-500">Hunt</span>
        </h1>
        <div class="loader-subtitle">Initializing System</div>
        <div class="progress-container">
            <div class="progress-bar"></div>
        </div>
    </div>
    
    <script>
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.body.classList.add('content-loaded');
                document.body.style.overflow = 'auto'; // Restore scrolling
            }, 2500); 
        });
    </script>

    <div class="bg-parallax-text">SCHEDULE</div>

    <div id="savvy-bot-container" style="transform: translate(80vw, 75vh);">
        <div class="bot-bubble" id="bot-bubble">Full schedule unlocked üßæ</div>
        <div class="bot-body" id="bot-body">
            <div class="laser-cone"></div>
            <div class="bot-cheek cheek-left"></div>
            <div class="bot-cheek cheek-right"></div>
            <div class="bot-antenna"></div>
            <div class="bot-eye" id="bot-eye">
                <div class="bot-pupil" id="bot-pupil"></div>
            </div>
        </div>
    </div>

    <header class="schedule-hero">
        <div class="schedule-hero-inner">
            <a href="index.html" class="back-pill">
                ‚üµ Back to Live Page
            </a>

            <h1 class="schedule-title text-white font-black mt-4">
                Event Schedule
            </h1>
            <p class="schedule-sub">
                Browse all events, venues and categories in one place.
            </p>

            <div class="search-container">
                <input type="text" id="search-input" class="search-input" placeholder="Find events, venues, or categories...">
                <div class="search-icon-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.3" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>

            <div class="toggle-wrapper">
                <div class="toggle-container">
                    <button onclick="setTab('upcoming')" id="tab-upcoming" class="toggle-btn active">
                        Upcoming & Live
                    </button>
                    <button onclick="setTab('results')" id="tab-results" class="toggle-btn inactive">
                        Results & Winners
                    </button>
                </div>
            </div>
            
        </div>
    </header>

    <div class="container">
        <div id="status-message">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mb-4"></div>
            <p class="text-gray-500 font-medium">Loading events...</p>
        </div>

        <div id="schedule-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 pb-12">
            </div>
        
        <div id="no-results" style="display: none;">
            <div class="text-6xl mb-4">üîç</div>
            <h3 class="text-xl font-bold text-gray-700">No events found</h3>
            <p class="text-gray-500">Try adjusting your search terms or switching tabs.</p>
        </div>

        <div style="text-align: center; margin-top: 12px; padding-bottom: 32px;">
            <a href="index.html" class="return-btn">
                <span class="icon">üè†</span>
                <span>Return to Home</span>
            </a>
        </div>
    </div>

    <footer class="bg-slate-950 text-slate-400 pt-24 pb-10 -mt-8 relative z-10" style="border-top-left-radius: 3rem; border-top-right-radius: 3rem;">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <h3 class="text-3xl font-bold text-white mb-2 tracking-tight">
                Savvy Hunt <span class="text-orange-500">2025</span>
            </h3>
            <p class="text-sm text-slate-500 mb-2">&copy; 2025 Savvy Hunt.</p>
        </div>
    </footer>

    <script>
        const SUPABASE_URL = 'https://updkjbvelzlleowheeyq.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVwZGtqYnZlbHpsbGVvd2hlZXlxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzOTI2NzcsImV4cCI6MjA3ODk2ODY3N30.lmCwbNDt3CiRXCVWjJl-4ZB242Ttfoo-J9yw3W7_Ark';

        if (typeof window.supabase === 'undefined') {
            document.getElementById('status-message').innerHTML = `
                <div class="bg-red-50 text-red-600 px-6 py-4 rounded-xl border border-red-100 shadow-sm font-medium inline-block">
                    Error: Supabase SDK failed to load.
                </div>`;
            throw new Error("Supabase SDK not loaded");
        }

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let allEvents = [];
        let currentTab = 'upcoming'; // 'upcoming' or 'results'

        // --- TAB SWITCHING LOGIC ---
        window.setTab = function(tab) {
            currentTab = tab;
            const btnUp = document.getElementById('tab-upcoming');
            const btnRes = document.getElementById('tab-results');

            if(tab === 'upcoming') {
                btnUp.classList.remove('inactive');
                btnUp.classList.add('active');
                btnRes.classList.remove('active');
                btnRes.classList.add('inactive');
                if(window.savvySay) window.savvySay("Showing Upcoming Events üìÖ");
            } else {
                btnRes.classList.remove('inactive');
                btnRes.classList.add('active');
                btnUp.classList.remove('active');
                btnUp.classList.add('inactive');
                if(window.savvySay) window.savvySay("Showing Winners üèÜ");
            }
            
            filterAndRender();
        }

        window.toggleFlip = function(cardId) {
            const cardInner = document.getElementById(cardId);
            if(cardInner) {
                cardInner.classList.toggle('flipped');
            }
        }

        async function loadSchedule() {
            console.log("Fetching schedule...");
            
            const { data, error } = await supabase
                .from('live_events')
                .select('*')
                .order('created_at', { ascending: false });

            const msg = document.getElementById('status-message');

            if (error) {
                msg.innerHTML = `<div class="text-red-600 font-bold">Database Error: ${error.message}</div>`;
                if (window.savvySay) window.savvySay("Database error ‚ö†Ô∏è");
                return;
            }

            if (!data || data.length === 0) {
                msg.innerHTML = `<div class="text-gray-400 text-xl font-bold">No events found.</div>`;
                if (window.savvySay) window.savvySay("No events found üôÉ");
                return;
            }

            allEvents = data;
            filterAndRender(); // Replaces renderEvents(allEvents)
            msg.style.display = 'none';

            if (window.savvySay) window.savvySay("Schedule updated ‚úÖ");
        }

        // New consolidated Filter Function
        function filterAndRender() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
            const hasSearch = searchTerm.length > 0;
            
            const filteredEvents = allEvents.filter(event => {
                // 1. Calculate Search Match
                // We convert values to strings to be safe against nulls
                const nameMatch = (event.name || '').toLowerCase().includes(searchTerm);
                const locMatch = (event.location || '').toLowerCase().includes(searchTerm);
                const catMatch = (event.category || '').toLowerCase().includes(searchTerm);

                // Check specific winner columns (for simple results)
                const winner1Match = (event.student_1 || '').toLowerCase().includes(searchTerm) || (event.winner_1 || '').toLowerCase().includes(searchTerm);
                const winner2Match = (event.student_2 || '').toLowerCase().includes(searchTerm) || (event.winner_2 || '').toLowerCase().includes(searchTerm);
                const winner3Match = (event.student_3 || '').toLowerCase().includes(searchTerm) || (event.winner_3 || '').toLowerCase().includes(searchTerm);

                // Check JSON results (for multi-winner events)
                const jsonMatch = event.result_json 
                    ? JSON.stringify(event.result_json).toLowerCase().includes(searchTerm) 
                    : false;

                const matchesSearch = nameMatch || locMatch || catMatch || winner1Match || winner2Match || winner3Match || jsonMatch;

                // LOGIC CHANGE: 
                // If the user is searching (hasSearch is true), we RETURN matchesSearch immediately.
                // This effectively ignores the tab selection while searching.
                if (hasSearch) {
                    return matchesSearch;
                }

                // If NOT searching, we strictly obey the tab logic.
                if (currentTab === 'upcoming') {
                    // Show everything NOT published (Live, Soon, Done-pending)
                    return event.status !== 'Results Published';
                } else {
                    // Only show published results
                    return event.status === 'Results Published';
                }
            });

            renderEvents(filteredEvents);
        }

        function renderEvents(events) {
            const grid = document.getElementById('schedule-list');
            const noResults = document.getElementById('no-results');
            
            grid.innerHTML = '';

            if(events.length === 0) {
                noResults.style.display = 'block';
                return;
            } else {
                noResults.style.display = 'none';
            }

            events.forEach((event, index) => {
                const uniqueId = `card-inner-${event.id || index}`; 
                
                let badgeClass = 'status-done';
                let badgeText = 'FINISHED';
                let btnText = 'View Results';
                let isResults = false;
                let frontCardClass = ''; 

                if (event.status === 'Results Published') {
                    badgeText = 'üèÅ RESULTS OUT';
                    isResults = true;
                    frontCardClass = 'is-results'; 
                } else if (event.status === 'Live') {
                    badgeClass = 'status-live';
                    badgeText = 'üî¥ LIVE NOW';
                    btnText = 'View Details';
                } else if (event.status === 'Soon') {
                    badgeClass = 'status-soon';
                    badgeText = 'üü° COMING SOON';
                    btnText = 'View Details';
                }

                // --- MULTI-WINNER LOGIC ---
                let winnersListHTML = '';

                if (isResults) {
                    const generateRows = (list, medal) => {
                        if(!list || list.length === 0) return '';
                        return list.map(w => `
                            <div class="winner-row">
                                <span class="medal">${medal}</span>
                                <div class="winner-info">
                                    <span class="student-name">${w.name || 'TBA'}</span>
                                    <span class="school-name">${w.school || ''}</span>
                                </div>
                            </div>
                        `).join('');
                    };

                    if (event.result_json) {
                        const r = event.result_json;
                        winnersListHTML += generateRows(r.p1, 'ü•á');
                        winnersListHTML += generateRows(r.p2, 'ü•à');
                        winnersListHTML += generateRows(r.p3, 'ü•â');
                    } else {
                        const p1 = [{ name: event.student_1, school: event.winner_1 }];
                        const p2 = [{ name: event.student_2, school: event.winner_2 }];
                        const p3 = [{ name: event.student_3, school: event.winner_3 }];
                        if(event.winner_1) winnersListHTML += generateRows(p1, 'ü•á');
                        if(event.winner_2) winnersListHTML += generateRows(p2, 'ü•à');
                        if(event.winner_3) winnersListHTML += generateRows(p3, 'ü•â');
                    }
                }

                const waitingHTML = `
                    <div class="flex flex-col items-center justify-center h-48 text-center text-gray-400">
                        <div class="text-4xl mb-3 opacity-50">‚è≥</div>
                        <p class="text-base font-bold text-gray-600">Coming Soon</p>
                        <p class="text-xs font-medium opacity-70">Results pending.</p>
                    </div>
                `;

                const cardHTML = `
                <div class="flip-card">
                    <div class="flip-card-inner" id="${uniqueId}">
                        <div class="flip-card-front ${frontCardClass}">
                            <div class="badge-container">
                                <span class="status-badge ${badgeClass}">${badgeText}</span>
                                <span class="category-pill">${event.category || 'General'}</span>
                            </div>
                            <div class="main-content">
                                <h3 class="font-extrabold">${event.name}</h3>
                                <div class="location">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-orange-500">
                                        <path fill-rule="evenodd" d="M11.54 22.351l.07.04.028.016a.76.76 0 00.723 0l.028-.015.071-.041a16.975 16.975 0 001.144-.742 19.58 19.58 0 002.683-2.282c1.944-1.99 3.963-4.98 3.963-8.827a8.25 8.25 0 00-16.5 0c0 3.846 2.02 6.837 3.963 8.827a19.58 19.58 0 002.682 2.282 16.975 16.975 0 001.145.742zM12 13.5a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                                    </svg>
                                    ${event.location || 'Venue TBA'}
                                </div>
                                <p class="teams-registered">Teams Registered: ${event.teams || 0}</p>
                            </div>
                            <button onclick="toggleFlip('${uniqueId}')" class="action-btn btn-view">
                                ${btnText} &rarr;
                            </button>
                        </div>
                        <div class="flip-card-back">
                            <div class="w-full flex-grow flex flex-col" style="min-height: 0; overflow: hidden;">
                                <h4 class="text-slate-800 font-black uppercase text-xs border-b-2 border-orange-100 pb-3 mb-2 tracking-wider text-left flex items-center gap-2 shrink-0">
                                    <span class="text-lg">üèÜ</span> Winners Podium
                                </h4>
                                <div class="results-scroll-area" style="display:flex; flex-direction:column; gap:4px; flex-grow:1;">
                                    ${isResults ? winnersListHTML : waitingHTML}
                                </div>
                            </div>
                            <button onclick="toggleFlip('${uniqueId}')" class="action-btn btn-back shrink-0">
                                &larr; Back to Info
                            </button>
                        </div>
                    </div>
                </div>
                `;
                
                grid.insertAdjacentHTML('beforeend', cardHTML);
            });
        }

        document.getElementById('search-input').addEventListener('input', (e) => {
            filterAndRender(); // Now uses consolidated filter
            const searchTerm = e.target.value;
            if (window.savvySay) {
                if (searchTerm.trim().length === 0) window.savvySay("Showing all events ‚ú®");
                else window.savvySay(`Filtering by "${searchTerm}" üîç`);
            }
        });

        loadSchedule();
        
        supabase.channel('schedule')
            .on('postgres_changes', { event: '*', schema: 'public', table: 'live_events' }, loadSchedule)
            .subscribe();

        /* ===== SAVVY BOT LOGIC ===== */
        document.addEventListener('DOMContentLoaded', () => {
            const botContainer = document.getElementById('savvy-bot-container');
            const botBody = document.getElementById('bot-body');
            const botEye = document.getElementById('bot-eye');
            const botPupil = document.getElementById('bot-pupil');
            const botBubble = document.getElementById('bot-bubble');

            if (!botContainer || !botBody || !botEye || !botPupil || !botBubble) return;

            let isSleeping = false;
            let idleTimer;
            let lastScrollY = 0;

            function showBubble(text) {
                botBubble.textContent = text;
                botBubble.classList.add('show');
                setTimeout(() => botBubble.classList.remove('show'), 2500);
            }

            // global hook
            window.savvySay = function(text) {
                if (isSleeping) wakeUp();
                showBubble(text);
            };

            function wakeUp() {
                if(isSleeping) {
                    isSleeping = false;
                    botEye.classList.remove('sleeping');
                }
                clearTimeout(idleTimer);
                idleTimer = setTimeout(goToSleep, 10000);
            }

            function goToSleep() {
                isSleeping = true;
                botEye.classList.add('sleeping');
                showBubble("Short nap‚Ä¶ üò¥");
            }

            function triggerScan() {
                botBody.classList.add('scanning');
                showBubble("Scanning events... üì°");
                setTimeout(() => botBody.classList.remove('scanning'), 2200);
            }

            function pickNewPosition() {
                if(isSleeping || botBody.classList.contains('scanning')) return;
                const w = window.innerWidth;
                const h = window.innerHeight;
                const pad = 60; 
                const botSize = 60;

                const zones = [
                    {x: w - pad - botSize, y: h * 0.7},
                    {x: pad, y: h * 0.7},
                    {x: w - pad - botSize, y: h * 0.3},
                    {x: pad, y: h * 0.3}
                ];
                const choice = zones[Math.floor(Math.random() * zones.length)];
                const x = choice.x + (Math.random() * 20 - 10);
                const y = choice.y + (Math.random() * 20 - 10);
                botContainer.style.transform = `translate(${x}px, ${y}px)`;

                if(Math.random() > 0.7) setTimeout(triggerScan, 2500);
            }

            setTimeout(pickNewPosition, 400);
            setInterval(pickNewPosition, 11000);

            botContainer.addEventListener('click', () => {
                if(isSleeping) { wakeUp(); showBubble("Back on duty ‚ö°"); return; }
                botBody.style.transform = "scale(0.9)";
                setTimeout(() => botBody.style.transform = "scale(1)", 150);
                const clickPhrases = [
                    "Checking stages‚Ä¶ üé≠",
                    "Everything on schedule ‚è±Ô∏è",
                    "No delays (I hope) üòÖ",
                    "So many events today!"
                ];
                const txt = clickPhrases[Math.floor(Math.random() * clickPhrases.length)];
                showBubble(txt);
                triggerScan();
            });

            document.addEventListener('mousemove', (e) => {
                wakeUp();
                if(!isSleeping && !botBody.classList.contains('scanning')) {
                    const rect = botEye.getBoundingClientRect();
                    const cx = rect.left + rect.width/2;
                    const cy = rect.top + rect.height/2;
                    const angle = Math.atan2(e.clientY - cy, e.clientX - cx);
                    const dist = Math.min(4, Math.hypot(e.clientX - cx, e.clientY - cy));
                    botPupil.style.transform = `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
                }
            });

            window.addEventListener('scroll', () => {
                wakeUp();
                const st = window.scrollY;
                if (Math.abs(st - lastScrollY) > 40) {
                    botBody.classList.add('windblown');
                } else {
                    botBody.classList.remove('windblown');
                }
                lastScrollY = st;
            });

            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('focus', () => {
                    wakeUp();
                    showBubble("Type to filter events üîé");
                });
            }
        });
    </script>
</body>
</html>